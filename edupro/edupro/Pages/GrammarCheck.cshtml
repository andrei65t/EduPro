@page
@model EduPro.Pages.GrammarCheckModel
@{
    ViewData["Title"] = "Verificare gramaticală";
    ViewData["PageTitle"] = "Corectează textul";
    ViewData["PageSubtitle"] = "Identifică și corectează automat erorile gramaticale și de ortografie";
}

<div class="row justify-content-center">
    <div class="col-xl-9">
        <div class="app-card">
            <div class="app-card-header">
                <div>
                    <div class="app-card-title">✏️ Text de verificat</div>
                    <div class="app-card-subtitle">Introduce textul sau selectează o notiță pentru a verifica gramatica</div>
                </div>
            </div>

            <div class="app-card-body">
                <form method="post">
                    <div class="mb-3">
                        <label asp-for="InputSource" class="form-label">
                            <i class="bi bi-ui-radios"></i> Sursa textului
                        </label>
                        <select asp-for="InputSource"
                                class="form-select"
                                style="background-color: #1e2530; color: #e4e7eb; border-color: #3d4756;"
                                onchange="toggleInputSource(this.value)">
                            <option value="manual">✍️ Text manual</option>
                            <option value="note">📄 Din notițele mele</option>
                        </select>
                        <div class="form-text text-muted">
                            <i class="bi bi-lightbulb"></i>
                            Alege dacă vrei să introduci text manual sau să selectezi o notiță existentă
                        </div>
                    </div>

                    <!-- Input manual -->
                    <div id="manualInput" class="mb-3">
                        <label asp-for="InputText" class="form-label">
                            <i class="bi bi-pencil-square"></i> Textul tău
                        </label>
                        <textarea asp-for="InputText"
                                  class="form-control"
                                  rows="8"
                                  style="background-color: #1e2530; color: #e4e7eb; border-color: #3d4756;"
                                  placeholder="Scrie sau lipește textul pe care vrei să-l verifici pentru erori gramaticale..."></textarea>
                        <div class="form-text text-muted">
                            <i class="bi bi-info-circle"></i>
                            Voi analiza textul și voi corecta toate erorile gramaticale și de ortografie
                        </div>
                    </div>

                    <!-- Selectare notiță -->
                    <div id="noteInput" class="mb-3" style="display: none;">
                        <label asp-for="SelectedNoteId" class="form-label">
                            <i class="bi bi-file-text"></i> Selectează notița
                        </label>
                        <select asp-for="SelectedNoteId"
                                class="form-select"
                                style="background-color: #1e2530; color: #e4e7eb; border-color: #3d4756;">
                            <option value="">-- Alege o notiță --</option>
                            @foreach (var note in Model.AvailableNotes)
                            {
                                <option value="@note.Id">
                                    @(note.Title ?? "Fără titlu")
                                    @if (note.Category != null)
                                    {
                                        <text> - @note.Category.Name</text>
                                    }
                                    (@note.CreatedAt.ToString("dd.MM.yyyy"))
                                </option>
                            }
                        </select>
                        <div class="form-text text-muted">
                            <i class="bi bi-lightbulb"></i>
                            @if (Model.AvailableNotes.Any())
                            {
                                <text>@Model.AvailableNotes.Count notițe disponibile</text>
                            }
                            else
                            {
                                <text>Nu ai notițe salvate. <a asp-page="/NotesUpload">Încarcă notițe aici</a></text>
                            }
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check2-square"></i> Verifică gramatica
                    </button>
                </form>

                <hr class="my-4" style="border-color: #3d4756;" />

                <div>
                    <h6 class="mb-3" style="color: #e4e7eb;">
                        <i class="bi bi-chat-left-text"></i> Text corectat
                    </h6>

                    @if (Model.CorrectedText != null)
                    {
                        <!-- Textul corectat -->
                        <div class="alert" style="background-color: #1a3d2e; border-color: #2d6a4f; color: #d8f3dc;">
                            <h6 class="alert-heading" style="color: #95d5b2;">
                                <i class="bi bi-check-circle-fill"></i> Verificare completă
                            </h6>
                            <hr style="border-color: #2d6a4f;">

                            @if (Model.Corrections.Any())
                            {
                                <div class="mb-3">
                                    <strong style="color: #95d5b2;">
                                        <i class="bi bi-tools"></i> Corecții aplicate:
                                    </strong>
                                    <ul class="mt-2 mb-0" style="color: #d8f3dc;">
                                        @foreach (var correction in Model.Corrections)
                                        {
                                            <li>@correction</li>
                                        }
                                    </ul>
                                </div>
                                <hr style="border-color: #2d6a4f;">
                            }

                            <div class="mt-3 p-3 rounded" style="background-color: #0d1b2a; color: #e4e7eb; border: 1px solid #3d4756; white-space: pre-wrap;">
                                @Model.CorrectedText
                            </div>

                            <div class="mt-3">
                                <button type="button"
                                        class="btn btn-sm btn-outline-light"
                                        onclick="copyToClipboard()">
                                    <i class="bi bi-clipboard"></i> Copiază textul corectat
                                </button>
                            </div>
                        </div>
                    }
                    else
                    {
                        <!-- Preview când nu există text corectat -->
                        <div class="rounded-3 p-4" style="background-color: #1e2530; border: 1px solid #3d4756;">
                            <div class="text-center mb-3">
                                <i class="bi bi-spell-check" style="font-size: 2.5rem; color: #4cc9f0;"></i>
                            </div>
                            <p class="mb-3 text-center" style="color: #adb5bd;">
                                <strong>Cum funcționează verificarea:</strong>
                            </p>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="p-3 rounded h-100" style="background-color: #0d1b2a; border: 2px solid #ffd60a;">
                                        <div class="mb-2" style="color: #ffd60a;">
                                            <i class="bi bi-1-circle-fill"></i> <strong>Introduce</strong>
                                        </div>
                                        <small style="color: #adb5bd;">
                                            Scrie sau selectează textul pe care vrei să-l verifici
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 rounded h-100" style="background-color: #0d1b2a; border: 2px solid #4cc9f0;">
                                        <div class="mb-2" style="color: #4cc9f0;">
                                            <i class="bi bi-2-circle-fill"></i> <strong>Analizează</strong>
                                        </div>
                                        <small style="color: #adb5bd;">
                                            AI-ul identifică automat toate erorile gramaticale
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 rounded h-100" style="background-color: #0d1b2a; border: 2px solid #52b788;">
                                        <div class="mb-2" style="color: #52b788;">
                                            <i class="bi bi-3-circle-fill"></i> <strong>Primește</strong>
                                        </div>
                                        <small style="color: #adb5bd;">
                                            Textul corect, gata de folosit, cu lista modificărilor
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Card informativ suplimentar -->
        <div class="app-card mt-3">
            <div class="app-card-body">
                <h6 class="mb-3" style="color: #4cc9f0;">
                    <i class="bi bi-info-circle-fill"></i> Tipuri de erori detectate
                </h6>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <div class="me-2" style="color: #ffd60a;">
                                <i class="bi bi-check-circle-fill"></i>
                            </div>
                            <div>
                                <strong style="color: #e4e7eb;">Ortografie</strong>
                                <div class="small" style="color: #adb5bd;">
                                    Cuvinte scrise greșit, diacritice lipsă sau incorecte
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <div class="me-2" style="color: #ffd60a;">
                                <i class="bi bi-check-circle-fill"></i>
                            </div>
                            <div>
                                <strong style="color: #e4e7eb;">Gramatică</strong>
                                <div class="small" style="color: #adb5bd;">
                                    Acorduri greșite, timpuri verbale, structuri sintactice
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <div class="me-2" style="color: #ffd60a;">
                                <i class="bi bi-check-circle-fill"></i>
                            </div>
                            <div>
                                <strong style="color: #e4e7eb;">Punctuație</strong>
                                <div class="small" style="color: #adb5bd;">
                                    Virgule, puncte, ghilimele plasate incorect
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-start">
                            <div class="me-2" style="color: #ffd60a;">
                                <i class="bi bi-check-circle-fill"></i>
                            </div>
                            <div>
                                <strong style="color: #e4e7eb;">Stil</strong>
                                <div class="small" style="color: #adb5bd;">
                                    Îmbunătățiri de claritate și lizibilitate
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function toggleInputSource(source) {
            const manualInput = document.getElementById('manualInput');
            const noteInput = document.getElementById('noteInput');

            if (source === 'manual') {
                manualInput.style.display = 'block';
                noteInput.style.display = 'none';
            } else {
                manualInput.style.display = 'none';
                noteInput.style.display = 'block';
            }
        }

        function copyToClipboard() {
            const text = '@Html.Raw(Model.CorrectedText?.Replace("'", "\\'").Replace("\n", "\\n").Replace("\r", ""))';
            navigator.clipboard.writeText(text.replace(/\\n/g, '\n')).then(function() {
                const btn = event.target.closest('button');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check2"></i> Copiat!';
                setTimeout(function() {
                    btn.innerHTML = originalHTML;
                }, 2000);
            });
        }
    </script>
}